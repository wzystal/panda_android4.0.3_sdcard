
(function(){var _ref,_ref2;var __slice=Array.prototype.slice;if(this.runSpecs==null){this.runSpecs=false;}
OF.isDevice=navigator.userAgent.match(/iPhone|iPad|Android/);OF.isBrowser=!OF.isDevice;if((_ref=window.location)!=null?(_ref2=_ref.href)!=null?_ref2.match(/isBrowser=[^&$]/):void 0:void 0){OF.isDevice=false;OF.isBrowser=true;}
({deviceType:{iOS:navigator.userAgent.match(/iPhone|iPad/),Android:navigator.userAgent.match(/Android/)}});OF.hasNativeInterface=false;OF.page=null;OF.global={};OF.orientation=null;OF.pages=[];OF.pages.replace=function(path){OF.pages.splice(0,OF.pages.length);return OF.push(path);};OF.log=function(data,level){var message;if(level==null){level='info';}
if(OF.isBrowser){console.log('WEBLOG:',data);}
if(window.runSpecs||window.runningSpecs){if(!OF.log.all){OF.log.all=[];OF.log.all.filter=function(pattern){return U.filter(OF.log.all,function(item){return pattern.test(item.message);});};}
OF.log.latest={data:data,level:level,message:data};OF.log.all.push(OF.log.latest);}
if(OF.device.ios3){return;}
if(OF.isDevice){if(typeof data==='object'){message=$.urlEncode(data);}else{message=""+data;}
return OF.action('log',{message:message,level:level});}};OF.debug=function(data){return OF.log(data,'debug');};OF.time=function(){var checkPointNames,now;checkPointNames=1<=arguments.length?__slice.call(arguments,0):[];if(OF.device.ios3){return;}
now=Date.now();if(OF.isBrowser){console.log("PROFILE "+now+" "+(checkPointNames.join('::')));}
if(OF.isDevice){return OF.action('profile',{time:now,checkPointNames:checkPointNames.join('::')});}};OF.setOrientation=function(newOrientation){var _ref3;if(newOrientation){OF.orientation=newOrientation;$('body').removeClass('orientation_portrait').removeClass('orientation_landscape').addClass("orientation_"+OF.orientation);return(_ref3=OF.topPage())!=null?typeof _ref3.orientationChanged==="function"?_ref3.orientationChanged(OF.orientation):void 0:void 0;}};OF.DEBUG={enableWeinre:function(host){var e;e=document.createElement("script");e.setAttribute("src","http://"+host+"/target/target-script-min.js#anonymous");return document.getElementsByTagName("body")[0].appendChild(e);}};OF.init={firstPage:function(){var options,pushParams;if(OF.isBrowser){options=$.urlDecode(location.href.split('?')[1]);pushParams=$.extend({},options);delete pushParams.url;$('html, body').css('-webkit-user-select','auto');if(options.url){$.ajax({url:'/webui/browser_config.json',dataType:'json',complete:function(xhr){var browserConfig;browserConfig=JSON.parse(xhr.responseText);if(browserConfig.remoteDebugHost){OF.DEBUG.enableWeinre(browserConfig.remoteDebugHost);}
OF.init.clientBoot(browserConfig);return OF.push(options.url,{params:pushParams});}});}else{OF.alert('ERROR','No Content to Load! This page must be called with a url like /webui/index.html?url=some/content_path');}}
OF.touch.bindHandlers();if(OF.isDevice&&'onerror'in window){$(window).error(function(e){OF.log(""+e.originalEvent.filename+":"+e.originalEvent.lineno+":"+e.originalEvent.message+"\n Stack: "+e.originalEvent.stack);return false;});}
return $(window).scroll(function(ev){var time,_ref3;if(ev.target.defaultView!==ev.currentTarget&&ev.target!==ev.currentTarget){return;}
time=new Date().getTime();if(window._lastScrollingTime&&(time-window._lastScrollingTime)<249){return false;}
window._lastScrollingTime=time;OF.touch.isScrolling=true;clearTimeout(window._stopScrollingCallback);if((_ref3=OF.page.eventHandle())!=null){_ref3.trigger('scroll');}
return window._stopScrollingCallback=setTimeout(function(){return OF.touch.isScrolling=false;},250);});},clientBoot:function(options){var body;OF.hasNativeInterface=options.hasNativeInterface;OF.user=options.user;if(!OF.user.name){OF.user.name=null;}
if(!OF.user.id||OF.user.id.toString()==='0'){OF.user.id=null;}
OF.game=options.game;OF.serverUrl=options.serverUrl;OF.actions=options.actions;OF.settings.enabled=OF.action.isSupported('readSetting')&&OF.action.isSupported('writeSetting');OF.clientVersion=options.clientVersion;OF.platform=options.platform;OF.device=options.device;OF.device.ios3=!!OF.device.os.match(/iPhone.*3\.\d\.\d/);if(OF.device.ios3){OF.action.delay=250;}
OF.dpi=options.dpi;OF.setOrientation(options.orientation);OF.disableGA=options.disableGA;OF.supports=options.supports||{};OF.appConfig=options.appConfig;OF.supports.fixedPosition=OF.platform==='android'&&OF.device.os.match(/v2\.2/)||OF.device.hardware==='browser';OF.supports.nativeScrolling='webkitOverflowScrolling'in document.documentElement.style;OF.action.sendController.init();OF.manifestUrl=options.manifestUrl;OF.log("Client Booted - userID: "+OF.user.id+" gameID: "+OF.game.id+" platform: "+OF.platform+" dpi: "+OF.dpi);body=$('body');body.addClass(OF.dpi).addClass(OF.platform);if(OF.supports.fixedPosition){body.addClass('fixed_position');}
return true;}};OF.forceSetTitle=function(title){var titleElement;if((titleElement=$('#header .title')).length>0){return titleElement.html(title);}};OF.topPage=function(){return OF.pages[OF.pages.length-1];};OF.notifyUserChange=function(name,id){var _ref3,_ref4;if(!(((_ref3=OF.user)!=null?_ref3.id:void 0)===id&&((_ref4=OF.user)!=null?_ref4.name:void 0)===name)){OF.user={name:name,id:id};return OF.flowControl.trigger('user_changed');}};OF.pushController=function(controllerName,options){controllerName=""+controllerName+"?"+($.urlEncode(options));if(OF.isDevice){location.href="openfeint://controller/"+controllerName;}
return OF.log("CONTROLLER: "+controllerName);};OF.barButton=function(title,onTouch){var options;options={};if(title.match(/\.png$/)){options.image=title.replace('xdpi.png',""+OF.dpi+".png");}else{options.title=title;}
OF.page.barButtonTouch=onTouch;return OF.action('addBarButton',options);};OF.alert=function(title,message,options){if(options==null){options={};}
options.title=title;options.message=message;OF.action('alert',options);if(OF.isBrowser){return alert(""+options.title+"\n\n"+options.message);}};OF.confirm=function(title,message,positive,negative,positiveCallback,negativeCallback){var confirmMessage;if(OF.isBrowser||!OF.action.isSupported('confirm')){confirmMessage=title.length>0?""+title+"\n\n"+message:""+message;if(confirm(confirmMessage)){return positiveCallback();}else{return typeof negativeCallback==="function"?negativeCallback():void 0;}}else{return OF.action('confirm',{title:title,message:message,positive:positive,negative:negative,callback:function(result){if(result){return positiveCallback();}else{return typeof negativeCallback==="function"?negativeCallback():void 0;}}});}};OF.savedFunctions={};OF.saveFunction=function(fn){var string;if(!$.isFunction(fn)){return;}
string=U.uniqueId('fn');OF.savedFunctions[string]=function(){fn.apply(this,arguments);if(!fn.persist){return delete OF.savedFunctions[string];}};return"OF.savedFunctions."+string;};OF.loader={count:0,show:function(){if(OF.device.ios3){return;}
$('#header .loading').show();return OF.loader.count+=1;},hide:function(){if(OF.device.ios3){return;}
OF.loader.count-=1;if(OF.loader.count<0){OF.loader.count=0;}
if(OF.loader.count===0){return $('#header .loading').hide();}}};OF.userDidLogin=function(user){var _base,_ref3;if((user!=null?(_ref3=user.id)!=null?_ref3.toString().length:void 0:void 0)&&user.id.toString()!=='0'){OF.user=user;}else{OF.user={name:null,id:null};}
return typeof(_base=OF.page).userDidLogin==="function"?_base.userDidLogin(user):void 0;};OF.settings={enabled:false,expectJsonAsString:null,clear:function(key){return OF.settings.write(key,null);},write:function(key,value){OF.action('writeSetting',{key:key,value:JSON.stringify(value)});if(OF.isBrowser){return OF.settings.browser.write(key,value);}},read:function(key,callback){var clientVersion,origCallback;if(!((OF.settings.expectJsonAsString!=null)||OF.isBrowser)){clientVersion=OF.clientVersion?OF.clientVersion.split('.'):[0,0,0];OF.settings.expectJsonAsString=OF.platform==='android'&&(parseInt(clientVersion[0],10)||0)<=1&&(parseInt(clientVersion[1],10)||0)<=7&&(parseInt(clientVersion[2],10)||0)<=5;}
if(OF.settings.expectJsonAsString){origCallback=callback;callback=function(jsonStringVal){return origCallback(jsonStringVal?JSON.parse(jsonStringVal):null);};}
OF.action('readSetting',{key:key,callback:callback});if(OF.isBrowser||!OF.settings.enabled){return callback(OF.settings.browser.read(key));}},browser:(function(){var obj,save,settingsObj;if(OF.isDevice){obj={};obj.clearAll=obj.write=obj.read=$.noop;return obj;}
settingsObj=null;U.each(document.cookie.split('; '),function(cookie){if(cookie.split('=')[0]==='WEBUI_SETTINGS'){try{return settingsObj=JSON.parse(decodeURIComponent(cookie.split('=')[1]));}catch(e){return settingsObj={};}}});settingsObj||(settingsObj={});save=function(){return document.cookie="WEBUI_SETTINGS="+(encodeURIComponent(JSON.stringify(settingsObj)));};return{clearAll:function(){settingsObj={};return save();},write:function(key,value){settingsObj[key]=value;return save();},read:function(key){var val;if((val=settingsObj[key])!=null){return val;}else{return null;}}};})()};OF.specs={load:function(pagePath){var flow;if(window.runSpecs){OF.api.allow=false;flow=pagePath.split('/')[0];$.loadScript("../spec/"+flow+"/index");jasmine.WaitsForBlock.TIMEOUT_INCREMENT=OF.isDevice?500:100;if(OF.device.ios3){jasmine.WaitsForBlock.TIMEOUT_INCREMENT=1000;return jasmine.DEFAULT_TIMEOUT_INTERVAL=10000;}}},run:function(){if(window.runSpecs&&OF.pages.length===1){window.runSpecs=false;return window.runningSpecs=true;}}};if(typeof NativeInterface!=="undefined"&&NativeInterface!==null){if(typeof NativeInterface.frameworkLoaded==="function"){NativeInterface.frameworkLoaded();}}
$(document).ready(OF.init.firstPage);}).call(this);