
(function(){var actionArgsToJSON,actionFormats,actionMethods,actionStrategies;OF.action=function(actionName,options,callback,immediate){var actionObj,key,spec,uri,value,_ref,_ref2;uri=""+actionName+"?";if((_ref=OF.supports)!=null?_ref.actionJSON:void 0){uri+=encodeURIComponent(actionArgsToJSON(options));}else{for(key in options){value=options[key];if($.isFunction(value)){options[key]=OF.saveFunction(value);}}
uri+=$.urlEncode(options);}
actionObj={name:actionName,options:options,uri:uri,callback:callback,immediate:immediate,ignore:OF.action.willIgnoreNext};if(!immediate){OF.action.queue.push(actionObj);}
if(immediate){OF.action.queue.unshift(actionObj);}
if((actionName!=null)&&actionName!=="log"){OF.action.willIgnoreNext=false;}
OF.action.sendController.start();if(OF.isBrowser&&actionObj.callback){U.defer(actionObj.callback);}
if(OF.isBrowser&&actionObj.name!=='log'){console.log('ACTION:',actionObj.name,options);}
if(spec=typeof jasmine!=="undefined"&&jasmine!==null?jasmine.getEnv().currentSpec:void 0){if((_ref2=spec.sentActions)!=null){_ref2;}else{spec.sentActions=[];};return spec.sentActions.push({name:actionName,options:options});}};OF.action.now=function(actionName,options,callback){return OF.action(actionName,options,callback,true);};OF.action.isSupported=function(actionName){return OF.actions.indexOf(actionName)>-1;};OF.action.ignoreNext=function(){return OF.action.willIgnoreNext=true;};OF.action.queue=[];OF.action.lastActionSentAt=0;actionArgsToJSON=function(object){if(object==null){object={};}
return JSON.stringify(object,function(key,value){if($.isFunction(value)){return OF.saveFunction(value);}else{return value;}});};actionFormats={single:function(actionObj){var uri;uri="openfeint://action/"+actionObj.uri;return uri;},batch:function(actionObjList){var actionObj,actions,json,uri;actions=(function(){var _i,_len,_results;_results=[];for(_i=0,_len=actionObjList.length;_i<_len;_i++){actionObj=actionObjList[_i];_results.push({name:actionObj.name,options:actionObj.options||{}});}
return _results;})();json=actionArgsToJSON({actions:actions});uri="openfeint://action/batch?"+(encodeURIComponent(json));return uri;}};actionMethods={"native":function(actionUri){return NativeInterface.action(actionUri);},iframe:function(actionUri){return $('#action_frame').attr('src',actionUri);},discard:function(actionUri){}};actionStrategies={nativeSingle:function(queue){var actionObj;actionObj=queue.shift();OF.action.sendController.runCallbacks(actionObj);return actionMethods["native"](actionFormats.single(actionObj));},iframeSingle:function(queue){var actionObj;actionObj=queue.shift();OF.action.sendController.runCallbacks(actionObj);return actionMethods.iframe(actionFormats.single(actionObj));},iframeBatch:function(queue){OF.action.sendController.runCallbacks(queue);actionMethods.iframe(actionFormats.batch(queue));return queue.splice(0,queue.length);},stringSingle:function(queue){var actionObj;actionObj=queue.shift();OF.action.sendController.runCallbacks(actionObj);return actionFormats.single(actionObj);},browser:function(queue){var actionObj;actionObj=queue.shift();OF.action.sendController.runCallbacks(actionObj);},ignore:function(queue){var actionObj,index,_results;index=0;_results=[];while(index<queue.length){_results.push(queue[index].ignore?(actionObj=queue.splice(index,1),OF.action.sendController.runCallbacks(actionObj)):index++);}
return _results;}};OF.action.sendController=(function(){var busy,ignoreStrategy,init,isReady,pull,pullStrategy,pushStrategy,ready,runCallbacks,send,start;isReady=true;pushStrategy=null;pullStrategy=null;ignoreStrategy=null;init=function(){pushStrategy={};if(OF.isBrowser){pushStrategy.method=actionStrategies.browser;}else if(OF.hasNativeInterface){pushStrategy.method=actionStrategies.nativeSingle;}else if(OF.action.isSupported('batch')){pushStrategy.method=actionStrategies.iframeBatch;pushStrategy.debounceDelay=1;}else{pushStrategy.method=actionStrategies.iframeSingle;}
pushStrategy.delay=OF.device.ios3?50:5;pullStrategy={};pullStrategy.method=actionStrategies.stringSingle;pullStrategy.delay=0;ignoreStrategy={};return ignoreStrategy.method=actionStrategies.ignore;};start=function(){if(isReady){return send();}};ready=function(){isReady=true;return send();};busy=function(){return isReady=false;};send=function(){ignoreStrategy.method(OF.action.queue);if(OF.action.queue.length===0){return;}
pushStrategy.method(OF.action.queue);OF.action.sendController.busy();return window.setTimeout(OF.action.sendController.ready,pushStrategy.delay);};pull=function(){ignoreStrategy.method(OF.action.queue);if(OF.action.queue.length===0){return"";}
return pullStrategy.method(OF.action.queue);};runCallbacks=function(action){var actionObj,_i,_len,_results;try{if($.isArray(action)){_results=[];for(_i=0,_len=action.length;_i<_len;_i++){actionObj=action[_i];_results.push((actionObj.callback?U.defer(actionObj.callback):void 0));}
return _results;}else{if(action!=null?action.callback:void 0){return U.defer(action.callback);}}}catch(e){return OF.log(e);}};return{start:start,ready:ready,busy:busy,init:init,runCallbacks:runCallbacks,pull:pull};})();OF.sendAction=OF.action;OF.actionIsSupported=$.deprecate(OF.action.isSupported,'OF.actionIsSupported()','OF.action.isSupported()');}).call(this);