
(function(){var Tab,TabControl;var __bind=function(fn,me){return function(){return fn.apply(me,arguments);};};OF.control={};Tab=(function(){function Tab(name,path,options,active,controller,contentElement,tabElement){this.name=name;this.path=path;this.options=options;this.active=active;this.controller=controller;this.contentElement=contentElement;this.tabElement=tabElement;this.pageStack=OF.pageStackController.addStack(this.contentElement,this.name);this.isLoaded=false;}
Tab.prototype.bindTouchHandler=function(){return $(this.tabElement).touch(__bind(function(){return this.controller.setActiveTab(this.name);},this));};Tab.prototype.goBack=function(options){if(options==null){options={};}
this.pageStack.back(options);return this.pageStack.length===0;};Tab.prototype.replace=function(path,options){this.path=path;if(options==null){options={};}
this.pageStack.replace(this.path,options);return this.isLoaded=true;};Tab.prototype.activate=function(options){var _ref;if(options==null){options=this.options;}
if(!this.isLoaded){this.load(options);}
this.controller.showTab(this);this.pageStack.activate();if((_ref=this.pageStack.activePage)!=null){_ref.activate();}
return OF.flowControl.trigger('load');};Tab.prototype.load=function(options){if(options==null){options={};}
this.pageStack.push(this.path,options);return this.isLoaded=true;};return Tab;})();TabControl=(function(){function TabControl(options){var callback,contentElement,index,newTab,params,tab,_i,_j,_len,_len2,_len3,_ref,_ref2,_ref3,_ref4,_ref5;this.options=options;this.tabs=[];_ref=this.options.tabs;for(_i=0,_len=_ref.length;_i<_len;_i++){tab=_ref[_i];contentElement=this.getElementName();this.options.location.append($("<div id='"+contentElement+"'></div>"));newTab=new Tab(tab.name,tab.path,tab.options,tab.active,this,"#"+contentElement,tab.element);$.extend(newTab,tab);newTab.bindTouchHandler();this.tabs.push(newTab);}
this.activeTabIndex=0;_ref2=this.tabs;for(index=0,_len2=_ref2.length;index<_len2;index++){tab=_ref2[index];if(tab.active){this.activeTabIndex=index;}}
this.location=this.options.location;if((_ref3=tab.options)!=null?_ref3.params:void 0){params=(_ref4=tab.options)!=null?_ref4.params:void 0;}else{params={};}
$.extend(params,OF.page.params);this.tabs[this.activeTabIndex].activate({params:params});if(options["native"]){this.nativeClient();}
_ref5=['beforeSwitch','afterSwitch'];for(_j=0,_len3=_ref5.length;_j<_len3;_j++){callback=_ref5[_j];if(!(callback in this.options)){this.options[callback]=$.noop;}}}
TabControl.prototype.getElementName=function(tabInput){return"tab"+(Math.floor(Math.random()*10000));};TabControl.prototype.setActiveTab=function(name){var index,newActiveTabIndex,tab,_len,_ref;_ref=this.tabs;for(index=0,_len=_ref.length;index<_len;index++){tab=_ref[index];if(tab.name===name){newActiveTabIndex=index;}}
return setActiveTabByIndex(newActiveTabIndex);};TabControl.prototype.setActiveTabByIndex=function(index){var activeTab,pagePushOptions;if(index===this.activeTabIndex){this.tabs[this.activeTabIndex].pageStack.back({root:true});}
this.activeTabIndex=index;activeTab=this.tabs[index];pagePushOptions=this.options.beforeSwitch(index,activeTab);activeTab.activate(pagePushOptions);return this.options.afterSwitch(index,activeTab);};TabControl.prototype.showTab=function(tab){var hidetabs,_i,_len,_ref;_ref=this.tabs;for(_i=0,_len=_ref.length;_i<_len;_i++){hidetabs=_ref[_i];$(hidetabs.contentElement).css({'display':'none'});}
return $(tab.contentElement).css({'display':'block'});};TabControl.prototype.goBack=function(options){if(options==null){options={};}
return this.tabs[this.activeTabIndex].goBack(options);};TabControl.prototype.nativeClient=function(){var nativeConfig,nativeTabOptionOf,tab,tabs;if(OF.action.isSupported('configureNativeTabs')){OF.tabCallback=__bind(function(index){return this.setActiveTabByIndex(index);},this);nativeConfig=this.options.nativeConfig||{};nativeTabOptionOf=function(tab){return{name:tab.name,activeImage:tab.activeImage,inactiveImage:tab.inactiveImage};};tabs=(function(){var _i,_len,_ref,_results;_ref=this.tabs;_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){tab=_ref[_i];_results.push(nativeTabOptionOf(tab));}
return _results;}).call(this);return OF.action('configureNativeTabs',{activeBackground:nativeConfig.activeBackground,inactiveBackground:nativeConfig.inactiveBackground,leftDivider:nativeConfig.leftDivider,rightDivider:nativeConfig.rightDivider,callback:'OF.tabCallback',height:nativeConfig.height,selectedTabName:this.tabs[this.activeTabIndex].name,tabs:tabs});}};TabControl.prototype.showNativeTabs=function(){OF.debug("showNativeTabs");return this.nativeClient();};TabControl.prototype.hideNativeTabs=function(){OF.debug("hideNativeTabs");if(OF.action.isSupported('configureNativeTabs')){return OF.action('configureNativeTabs',{tabs:[]});}};return TabControl;})();OF.control.TabControl=TabControl;}).call(this);